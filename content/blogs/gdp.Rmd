---
categories:
- ""
- ""
date: "2020-09-15"
description: GDP
draft: false
image: country.jpg
keywords: ""
slug: gdp
title: How does the GDP differ between developing and developed countries?

---


```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)
# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(lubridate)
library(here)
library(skimr)
library(janitor)
library(httr)
library(readxl)
library(vroom)
library(kableExtra)
library(infer)
```


# Challenge 2:GDP components over time and among countries

At the risk of oversimplifying things, the main components of gross domestic product, GDP are personal consumption (C), business investment (I), government spending (G) and net exports (exports - imports). You can read more about GDP and the different approaches in calculating at the [Wikipedia GDP page](https://en.wikipedia.org/wiki/Gross_domestic_product).

The GDP data we will look at is from the [United Nations' National Accounts Main Aggregates Database](https://unstats.un.org/unsd/snaama/Downloads), which contains estimates of total GDP and its components for all countries from 1970 to today. We will look at how GDP and its components have changed over time, and compare different countries and how much each component contributes to that country's GDP. The file we will work with is [GDP and its breakdown at constant 2010 prices in US Dollars](http://unstats.un.org/unsd/amaapi/api/file/6).


```{r read_GDP_data}

UN_GDP_data  <- read_excel(here::here("data", "Download-GDPconstant-USD-countries.xls"), # Excel filename
                sheet="Download-GDPconstant-USD-countr", # Sheet name
                skip=2) # Number of rows to skip

```


We first tidy up the data, as it is in wide format. Furthermore, we divide by `1e9` to express all figures in billions and rename
the indicators into something shorter.


```{r reshape_GDP_data}

# for the values remapping / renaming
from = c("Household consumption expenditure (including Non-profit institutions serving households)",
         "General government final consumption expenditure",
         "Exports of goods and services",
         "Imports of goods and services")

to = c("Household expenditure",
       "Government expenditure",
       "Exports",
       "Imports")

tidy_GDP_data <- UN_GDP_data %>% 
  # bring into long format
  pivot_longer(cols = `1970`:`2017`, names_to = "year", values_to = "values") %>% 
  # express in billions
  mutate(values = values / 1e9) %>% 
  # rename indicators
  mutate(IndicatorName = plyr::mapvalues(IndicatorName, from, to))


# let's have a look at the data
glimpse(tidy_GDP_data)


# Let us compare GDP components for these 3 countries
country_list <- c("United States","India", "Germany")

```

Plot Reproduction:

```{r challenge_2_1, fig.width = 9, fig.height=5.5}

# create plot
tidy_GDP_data %>% 
  # only visualise for countries in the country_list
  filter(Country %in% country_list) %>% 
  # only visualise certain indicators
  filter(IndicatorName %in% c("Gross capital formation", 
                              "Exports", 
                              "Government expenditure", 
                              "Household expenditure", 
                              "Imports")) %>% 
  # make indicator a factor with correct ordering
  mutate(IndicatorName = factor(IndicatorName, 
                                levels = c("Gross capital formation",
                                           "Exports",
                                           "Government expenditure",
                                           "Household expenditure",
                                           "Imports"))) %>% 
  # ggplot framework
  ggplot(aes(x = year, y = values, color = IndicatorName)) +
  # add lines
  geom_line(aes(group = IndicatorName), size = 0.8) + 
  # faceting by country
  facet_wrap(~Country) +
  # custom scale breaks
  scale_x_discrete(breaks = c(1970, 1980, 1990, 2000, 2010)) +
  # bw theme
  theme_bw() +
  # labels (also for the legend)
  labs(title = "GDP components over time",
       subtitle = "In constant 2010 USD",
       x = "",
       y = "Billion US$",
       color = "Components of GDP")
  

```


original Plot:


```{r gdp1, echo=FALSE, out.width="100%"}
knitr::include_graphics(here::here("images", "gdp1.png"), error = FALSE)
```


Secondly, recall that GDP is the sum of Household Expenditure (Consumption *C*), Gross Capital Formation (business investment *I*), Government Expenditure (G) and Net Exports (exports - imports). Even though there is an indicator `Gross Domestic Product (GDP)` in the dataframe, we calculate it given its components discussed above.

```{r GDP_calculation}

# wrangle data and calculate GDP
tidy_GDP_data_2 <- tidy_GDP_data %>% 
  # bring in wide format to easily calculate GDP
  pivot_wider(names_from = IndicatorName, values_from = values) %>% 
  # calculate Net Exports, GDP and % difference in GDPs
  mutate(`Net Exports` = Exports-Imports,
         `Calculated GDP` = `Household expenditure` + `Gross capital formation` + `Government expenditure` + `Net Exports`,
         `Percentage Change` = (`Calculated GDP` - `Gross Domestic Product (GDP)`)/`Gross Domestic Product (GDP)`)

# summary statistics
mosaic::favstats(~`Percentage Change`, data=tidy_GDP_data_2) %>% 
  kbl(caption = "overall summary statistics for the % difference between calculated and included GDP") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) # have a nice HTML table

# summary statistics
#mosaic::favstats(`Percentage Change`~year, data=tidy_GDP_data_2) %>% 
#  kbl(caption = "summary statistics for the % difference between calculated and included GDP per year") %>%
#  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) # have a nice HTML table

```

As we can see, the % difference of the two GDPs is in most cases around 0, i.e. both GDPs are in most cases approximately the same.

Plot Reproduction:

```{r challenge_2_2, fig.width = 12, fig.height=6}

# prepare data and plot
tidy_GDP_data_2 %>% 
  # calculate the percentage values
  mutate(`Government Expenditure` = `Government expenditure` / `Gross Domestic Product (GDP)`,
         `Gross capital formation` = `Gross capital formation` / `Gross Domestic Product (GDP)`,
         `Household Expenditure` = `Household expenditure` / `Gross Domestic Product (GDP)`,
         `Net Exports` = `Net Exports` / `Gross Domestic Product (GDP)`) %>% 
  # bring back into long format
  pivot_longer(cols = `Final consumption expenditure`:`Household Expenditure`, 
               names_to = "IndicatorName", 
               values_to = "values") %>% 
  # only visualise for countries in the country_list
  filter(Country %in% country_list) %>% 
  # only visualise certain indicators
  filter(IndicatorName %in% c("Gross capital formation", 
                              "Government Expenditure", 
                              "Household Expenditure", 
                              "Net Exports")) %>% 
  # ggplot framework
  ggplot(aes(x = year, y = values, color = IndicatorName)) +
  # add lines
  geom_line(aes(group = IndicatorName), size = 0.8) + 
  # faceting by country
  facet_wrap(~Country) +
  # custom scale breaks
  scale_x_discrete(breaks = c(1970, 1980, 1990, 2000, 2010)) +
  # percentage scale on y axis
  scale_y_continuous(labels = scales::percent) +
  # bw theme
  theme_bw() +
  # labels
  labs(title = "GDP and its breakdown at constant 2010 prices in US Dollars",
       caption = "Source: United Nations, https://unstats.un.org/unsd/snaama/Downloads",
       x = "",
       y = "proportion") +
  # no legend title
  theme(legend.title = element_blank())

```